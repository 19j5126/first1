<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>360度動画</title>
  <script src="aframe.min.js"></script>
</head>
<body>
<a-scene>
  <a-assets>
  　<video id="video" src="tobira1.MP4" preload="auto" autoplay></video>
  </a-assets>
  <a-videosphere src="#video" rotation="0 -90 0"></a-videosphere>
  <!-- 動画の autoplay が効かない場合用の、再生・停止ボタン -->
  <a-box id="play" position="2 1.5 -4" scale="1 1 1" color="#00000000" opacity="0"></a-box>


  
  <!-- リンク用のbox -->
  <a-box id="link" position="-0.4 1.5 -4" scale="3 3 1" color="#00000000" material="opacity: 0;" linkbox></a-box>
  
  <!-- 再生・停止ボタンを押すための視線カーソル（スマホ用） -->

  <!-- TODO:視点 -->
  <a-camera>
    <a-cursor fuse="true" fuse-timeout="500"></a-cursor>
  </a-camera>
  
</a-scene>

<!-- 動画の再生・停止のための JavaScript -->
<script>
const video = document.getElementById("video");   // 動画の取得
const btnPlay = document.getElementById("play");  // 再生ボタンの取得
btnPlay.addEventListener("click", (e) => {        // クリックされたら
  video.play();                                   // 動画を再生
});
</script>

<script>
  function toLink(){
    window.location.href = "https://19j5126.github.io/tobirademo/"
  }

  AFRAME.registerComponent('linkbox', {
    init: function () {  //aframeのコンポーネントの考え方
      console.log(this);　//aframeのコンポーネントの考え方
      const element = this.el;　　//aframeのコンポーネントの考え方
      element.addEventListener('mouseenter', function () {　//マウスの代わりに視線でクリック
        console.log('mouseenter');
        setTimeout(toLink, 3500); //toLink関数を実行
        
      });
    }
  });
 
</script>
  
<script>
  // ジャイロセンサーが有効か？
if(window.DeviceOrientationEvent){
    // ★iOS13向け: ユーザーにアクセスの許可を求める関数があるか？
    if(DeviceOrientationEvent.requestPermission){
        var sensor_contents= document.getElementById("sensor_contents");
        // id="sensor_contents" な要素がクリックされたら
        sensor_contents.addEventListener("click", function(){
            // ★ジャイロセンサーのアクセス許可をリクエストする
            DeviceOrientationEvent.requestPermission().then(function(response){
                // リクエストが許可されたら
                if(response === "granted"){
                    // deviceorientationが有効化される
                }
            }).catch(function(e){
                console.log(e);
            });
        });
    // iOS13以外
    }else{
        // 何もしない
    }
}
 
// 従来の処理
// deviceorientationだったりdevicemotionだったりする
function deviceorientationHandler(){
    // ※※※※※※※※※※※※※※※※
    //   ここに従来の処理を書いていく
    // ※※※※※※※※※※※※※※※※
}
window.addEventListener("deviceorientation", deviceorientationHandler);
</script>

</body>
</html>
